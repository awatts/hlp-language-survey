<!doctype html>
<html class="no-js" lang="">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Language Survey Demo</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">
  <script src="js/modernizr-3.2.0-full.min.js"></script>
</head>
<body>
  <!--[if lt IE 8]>
  <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
  <![endif]-->

  <form>
    <div id="container"></div>
  </form>

  <script id="template" type="text/ractive">
  <div>
    <label>Which country/region do you currently live in? Please choose from the suggestions whenever possible.
    (Suggestions are offical ISO 3166-1 assigned names.) If other, please specify:
      <input type="text" name="country" list="countries" value="{{current_country}}">
      <datalist id="countries">
          <select name="countries"> <!-- fallback for non-HTML5 browsers -->
            {{#country_choices}}
            <option value="{{this.name}}">{{this.name}}</option>
            {{/country_choices}}
          </select>
        </datalist>
      </label>
    </div>

    {{#if current_country === "United States"}}
    <div>
      <label>US Region. Please choose the region of the US where you live:
        <select name="usregion">
          {{#us_region_choices}}
          <option value="{{this}}">{{this}}</option>
          {{/us_region_choices}}
        </select>
      </label>
    </div>
    {{/if}}

    {{#if current_country === "United States"}}
    <div>
      <label>US Region. Please choose the region of the US where you live:
        <select name="usregion_census">
          {{#census_regions}}
          <optgroup label="{{this.region}}">
          {{#subregions}}
            <option value="{{this}}">{{this}}</option>
          {{/subregions}}
          </optgroup>
          {{/census_regions}}
        </select>
      </label>
    </div>
    {{/if}}

    <div>
      <label>Which language(s) do you predominantly use at home? Please choose from
       the suggestions whenever possible. If other, please specify:
        <input type="text" name="lang" list="languages" on-keydown='inputKeypress(event)' on-change='addHomeLanguage(event)' placeholder='Add a language used at home'>
      </label>
      <datalist id="languages">
        <select name="languages"> <!-- fallback for non-HTML5 browsers -->
          {{#language_choices}}
          <option value="{{this}}">{{this}}</option>
          {{/language_choices}}
        </select>
      </datalist>
      <ul>
      {{#home_languages:i}}
      <li class='item'>{{this}}<button on-click='removeHomeLanguage(event,i)' class='destroy'></button></li>
      {{/home_languages}}
      </ul>
    </div>

    {{#home_languages:i}}
    <div class="surveyq">
      <p>At what age did you begin to learn {{this}}?
      <select name="{{this}}.start_age">
        {{# _.range(1,101) }}
        <option value="{{this}}">{{this}}</option>
        {{/}}
      </select>
      </p>
    </div>
    {{/home_languages}}

    {{#home_languages:i}}
    <div class="surveyq">
      <p>At what age did you feel comfortable speaking {{this}}? (If you still do not feel comfortable, please select “Not yet.”)
        <select name="{{this}}.comfort_age">
          <option value="Not yet">Not yet</option>
          {{# _.range(1,101) }}
          <option value="{{this}}">{{this}}</option>
          {{/}}
        </select>
      </p>
    </div>
    {{/home_languages}}

    <div class="surveyq">
      <p>If you had to choose which language to use for the rest of your life, which language would it be?
        <select name="one_language">
          {{#home_languages:i}}
          <option value="{{this}}">{{this}}</option>
          {{/home_languages}}
        </select>
      </p>
    </div>

    {{#home_languages:i}}
    <div class="surveyq">
      <p>How many years of schooling (primary school through university) did you have in {{this}}
        <select name="{{this}}.years_schooling">
          {{# _.range(0,26) }}
          <option value="{{this}}">{{this}}</option>
          {{/}}
        </select>
      </p>
    </div>
    {{/home_languages}}

    <div class="surveyq">
      <p>When doing math in your head (such as multiplying 123 x 4), which language do you calculate numbers in in? (You can check more than one.)</p>
      <ul>
        {{#home_languages:i}}
        <li>
          <label for="{{this}}.math_language">{{this}}
            <input type="checkbox" name="{{this}}.math_language" id="{{this}}.math_language" value="{{this}}"/>
          </label>
        </li>
        {{/home_languages}}
      </ul>
    </div>

    <div class="surveyq" id="foreign_accent">
      <ul>
      {{#home_languages:i}}
      <li>
        <p>When speaking {{this}}, do you have a foreign accent?
          <label for="{{this}}.foreign_accent_yes">Yes
            <input type="radio" name="{{this}}.foreign_accent" id="{{this}}.foreign_accent_yes">
          </label>
          <label for="{{this}}.foreign_accent_no">No
            <input type="radio" name="{{this}}.foreign_accent" id="{{this}}.foreign_accent_no">
          </label>
        </p>
      </li>
      {{/home_languages}}
      </ul>
    </div>

    <div class="surveyq" id="lost_fluency">
      <ul>
      {{#home_languages:i}}
      <li>
        <p>Do you feel that you have lost any fluency in {{this}}?
          <label for="{{this}}.lost_fluency_yes">Yes
            <input type="radio" name="{{this}}.lost_fluency" id="{{this}}.lost_fluency_yes">
          </label>
          <label for="{{this}}.lost_fluency_no">No
            <input type="radio" name="{{this}}.lost_fluency" id="{{this}}.lost_fluency_no">
          </label>
        </p>
      </li>
      {{/home_languages}}
      </ul>
    </div>


  </script>

  <!--[if lt IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.1.14/es5-shim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
  <![endif]-->
  <!--[if gte IE 9]><!-->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <!--<![endif]-->
  <script src="//cdnjs.cloudflare.com/ajax/libs/webshim/1.15.10/minified/polyfiller.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/ractive/0.7.3/ractive.min.js"></script>
  <script type="text/javascript">
  // this vastly improves datalist in Chrome (broken) and Safari (nonexistant),
  // but makes it way worse in Firefox (full working implementation)
    webshim.setOptions("forms", {
      lazyCustomMessages: true,
      replaceValidationUI: true,
      customDatalist: "auto",
      list: {
        "filter": "^"
      }
    });

    webshim.polyfill('forms');
  </script>
  <script src="js/language_survey.js"></script>
</body>
</html>
